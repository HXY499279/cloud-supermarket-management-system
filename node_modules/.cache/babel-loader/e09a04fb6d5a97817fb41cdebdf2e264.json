{"ast":null,"code":"export default function pretty(min, max, n) {\n  if (n === void 0) {\n    n = 5;\n  }\n\n  var res = {\n    max: 0,\n    min: 0,\n    ticks: []\n  };\n\n  if (min === max) {\n    return {\n      max: max,\n      min: min,\n      ticks: [min]\n    };\n  }\n  /*\n    R pretty:\n    https://svn.r-project.org/R/trunk/src/appl/pretty.c\n    https://www.rdocumentation.org/packages/base/versions/3.5.2/topics/pretty\n    */\n\n\n  var h = 1.5; // high.u.bias\n\n  var h5 = 0.5 + 1.5 * h; // u5.bias\n  // 反正我也不会调参，跳过所有判断步骤\n\n  var d = max - min;\n  var c = d / n; // 当d非常小的时候触发，但似乎没什么用\n  // const min_n = Math.floor(n / 3);\n  // const shrink_sml = Math.pow(2, 5);\n  // if (Math.log10(d) < -2) {\n  //   c = (_.max([ Math.abs(max), Math.abs(min) ]) * shrink_sml) / min_n;\n  // }\n\n  var base = Math.pow(10, Math.floor(Math.log10(c)));\n  var toFixed = base < 1 ? Math.ceil(Math.abs(Math.log10(base))) : 0;\n  var unit = base;\n\n  if (2 * base - c < h * (c - unit)) {\n    unit = 2 * base;\n\n    if (5 * base - c < h5 * (c - unit)) {\n      unit = 5 * base;\n\n      if (10 * base - c < h * (c - unit)) {\n        unit = 10 * base;\n      }\n    }\n  }\n\n  var nu = Math.ceil(max / unit);\n  var ns = Math.floor(min / unit);\n  res.max = Math.max(nu * unit, max);\n  res.min = Math.min(ns * unit, min);\n  var x = Number.parseFloat((ns * unit).toFixed(toFixed));\n\n  while (x < max) {\n    res.ticks.push(x);\n    x += unit;\n\n    if (toFixed) {\n      x = Number.parseFloat(x.toFixed(toFixed));\n    }\n  }\n\n  res.ticks.push(x);\n  return res;\n}","map":{"version":3,"sources":["../../src/util/pretty.ts"],"names":[],"mappings":"AAAA,eAAc,SAAU,MAAV,CAAiB,GAAjB,EAA8B,GAA9B,EAA2C,CAA3C,EAAwD;AAAb,MAAA,CAAA,KAAA,KAAA,CAAA,EAAA;AAAA,IAAA,CAAA,GAAA,CAAA;AAAa;;AAEpE,MAAM,GAAG,GAAG;AACV,IAAA,GAAG,EAAE,CADK;AAEV,IAAA,GAAG,EAAE,CAFK;AAGV,IAAA,KAAK,EAAE;AAHG,GAAZ;;AAMA,MAAI,GAAG,KAAK,GAAZ,EAAiB;AACf,WAAO;AACL,MAAA,GAAG,EAAA,GADE;AAEL,MAAA,GAAG,EAAA,GAFE;AAGL,MAAA,KAAK,EAAE,CAAC,GAAD;AAHF,KAAP;AAKD;AAED;;;;AAII;;;AACJ,MAAM,CAAC,GAAG,GAAV,CArBoE,CAqBrD;;AACf,MAAM,EAAE,GAAG,MAAM,MAAM,CAAvB,CAtBoE,CAsB1C;AAC1B;;AACA,MAAM,CAAC,GAAG,GAAG,GAAG,GAAhB;AACA,MAAM,CAAC,GAAG,CAAC,GAAG,CAAd,CAzBoE,CA0BpE;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM,IAAI,GAAG,IAAI,CAAC,GAAL,CAAS,EAAT,EAAa,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,KAAL,CAAW,CAAX,CAAX,CAAb,CAAb;AACA,MAAM,OAAO,GAAG,IAAI,GAAG,CAAP,GAAW,IAAI,CAAC,IAAL,CAAU,IAAI,CAAC,GAAL,CAAS,IAAI,CAAC,KAAL,CAAW,IAAX,CAAT,CAAV,CAAX,GAAmD,CAAnE;AACA,MAAI,IAAI,GAAG,IAAX;;AACA,MAAI,IAAI,IAAJ,GAAW,CAAX,GAAe,CAAC,IAAI,CAAC,GAAG,IAAR,CAApB,EAAmC;AACjC,IAAA,IAAI,GAAG,IAAI,IAAX;;AACA,QAAI,IAAI,IAAJ,GAAW,CAAX,GAAe,EAAE,IAAI,CAAC,GAAG,IAAR,CAArB,EAAoC;AAClC,MAAA,IAAI,GAAG,IAAI,IAAX;;AACA,UAAI,KAAK,IAAL,GAAY,CAAZ,GAAgB,CAAC,IAAI,CAAC,GAAG,IAAR,CAArB,EAAoC;AAClC,QAAA,IAAI,GAAG,KAAK,IAAZ;AACD;AACF;AACF;;AACD,MAAM,EAAE,GAAG,IAAI,CAAC,IAAL,CAAU,GAAG,GAAG,IAAhB,CAAX;AACA,MAAM,EAAE,GAAG,IAAI,CAAC,KAAL,CAAW,GAAG,GAAG,IAAjB,CAAX;AAEA,EAAA,GAAG,CAAC,GAAJ,GAAU,IAAI,CAAC,GAAL,CAAS,EAAE,GAAG,IAAd,EAAoB,GAApB,CAAV;AACA,EAAA,GAAG,CAAC,GAAJ,GAAU,IAAI,CAAC,GAAL,CAAS,EAAE,GAAG,IAAd,EAAoB,GAApB,CAAV;AAEA,MAAI,CAAC,GAAG,MAAM,CAAC,UAAP,CAAkB,CAAC,EAAE,GAAG,IAAN,EAAY,OAAZ,CAAoB,OAApB,CAAlB,CAAR;;AACA,SAAO,CAAC,GAAG,GAAX,EAAgB;AACd,IAAA,GAAG,CAAC,KAAJ,CAAU,IAAV,CAAe,CAAf;AACA,IAAA,CAAC,IAAI,IAAL;;AACA,QAAI,OAAJ,EAAa;AACX,MAAA,CAAC,GAAG,MAAM,CAAC,UAAP,CAAkB,CAAC,CAAC,OAAF,CAAU,OAAV,CAAlB,CAAJ;AACD;AACF;;AACD,EAAA,GAAG,CAAC,KAAJ,CAAU,IAAV,CAAe,CAAf;AAEA,SAAO,GAAP;AACD","sourceRoot":"","sourcesContent":["export default function pretty(min, max, n) {\n    if (n === void 0) { n = 5; }\n    var res = {\n        max: 0,\n        min: 0,\n        ticks: [],\n    };\n    if (min === max) {\n        return {\n            max: max,\n            min: min,\n            ticks: [min],\n        };\n    }\n    /*\n      R pretty:\n      https://svn.r-project.org/R/trunk/src/appl/pretty.c\n      https://www.rdocumentation.org/packages/base/versions/3.5.2/topics/pretty\n      */\n    var h = 1.5; // high.u.bias\n    var h5 = 0.5 + 1.5 * h; // u5.bias\n    // 反正我也不会调参，跳过所有判断步骤\n    var d = max - min;\n    var c = d / n;\n    // 当d非常小的时候触发，但似乎没什么用\n    // const min_n = Math.floor(n / 3);\n    // const shrink_sml = Math.pow(2, 5);\n    // if (Math.log10(d) < -2) {\n    //   c = (_.max([ Math.abs(max), Math.abs(min) ]) * shrink_sml) / min_n;\n    // }\n    var base = Math.pow(10, Math.floor(Math.log10(c)));\n    var toFixed = base < 1 ? Math.ceil(Math.abs(Math.log10(base))) : 0;\n    var unit = base;\n    if (2 * base - c < h * (c - unit)) {\n        unit = 2 * base;\n        if (5 * base - c < h5 * (c - unit)) {\n            unit = 5 * base;\n            if (10 * base - c < h * (c - unit)) {\n                unit = 10 * base;\n            }\n        }\n    }\n    var nu = Math.ceil(max / unit);\n    var ns = Math.floor(min / unit);\n    res.max = Math.max(nu * unit, max);\n    res.min = Math.min(ns * unit, min);\n    var x = Number.parseFloat((ns * unit).toFixed(toFixed));\n    while (x < max) {\n        res.ticks.push(x);\n        x += unit;\n        if (toFixed) {\n            x = Number.parseFloat(x.toFixed(toFixed));\n        }\n    }\n    res.ticks.push(x);\n    return res;\n}\n//# sourceMappingURL=pretty.js.map"]},"metadata":{},"sourceType":"module"}