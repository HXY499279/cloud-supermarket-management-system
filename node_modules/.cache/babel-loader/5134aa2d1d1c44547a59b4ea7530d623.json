{"ast":null,"code":"import _classCallCheck from\"D:/code/cloud-supermarket-management-system/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/code/cloud-supermarket-management-system/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"D:/code/cloud-supermarket-management-system/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"D:/code/cloud-supermarket-management-system/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{Descriptions,Divider,Breadcrumb,Button,Input,message,InputNumber,Empty,Select,Col,Row,Space,Affix}from'antd';import{BrowserRouter,Link,Switch,Route}from'react-router-dom';import{SearchOutlined}from'@ant-design/icons';import InfiniteScroll from'react-infinite-scroller';import{nanoid}from'nanoid';import'./index.css';import reqwest from'reqwest';import CommodityCard from'../../../utils/CimCommodityCard/CommodityCard';import CimAddCommodity from'../../../utils/CimAddCommodity/CimAddCommodity';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Option=Select.Option;var Cim=/*#__PURE__*/function(_Component){_inherits(Cim,_Component);var _super=_createSuper(Cim);function Cim(){var _this;_classCallCheck(this,Cim);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={data:[],subCategory:[],loading:false,hasMore:true,total:'',isAddCategory:false,count:0,pageSize:8};_this.fetchData=function(callback){var count=_this.state.count;var pageSize=_this.state.pageSize;count+=1;_this.setState({count:count});var data={count:count,pageSize:pageSize};reqwest({url:'/commoditylist',type:'json',method:'post',data:data,success:function success(res){callback(res);}});};_this.handleInfiniteOnLoad=function(){var _this$state=_this.state,data=_this$state.data,total=_this$state.total;_this.setState({loading:true});if(data.length>=total){message.warning('商品已展示完毕');_this.setState({hasMore:false,loading:false});return;}_this.fetchData(function(res){data=data.concat(res.commodities);_this.setState({data:data,loading:false,total:res.total});});};_this.renderCommodityList=function(cid){var count=_this.state.count;var pageSize=_this.state.pageSize;var end=count*pageSize;reqwest({url:'/deletecommodity',method:'post',type:'json',data:{cid:cid,end:end}}).then(function(res){console.log(res);_this.setState({data:res.commodities});message.success('删除成功');},function(){message.error('删除失败');});};_this.showCommodity=function(){console.log(_this.state.data);return _this.state.data.map(function(item,index){return/*#__PURE__*/ (// 循环项的key值，不要用index，可以用nanoid来设置\n_jsx(Col,{span:6,style:{marginBottom:20},children:/*#__PURE__*/_jsx(CommodityCard,{data:item,renderCommodityList:_this.renderCommodityList})},nanoid()));});};_this.CimSearch=function(){var _ref=[_this.idInput.value,_this.nameInput.state.value,_this.categorySelect.value,undefined===_this.statusSelect.value?_this.statusSelect.props.defaultValue:_this.statusSelect.value],cid=_ref[0],_ref$=_ref[1],commodityName=_ref$===void 0?' ':_ref$,_ref$2=_ref[2],category=_ref$2===void 0?' ':_ref$2,status=_ref[3];// 去除搜索内容中的空格，常见标点符号\nfunction reg(str){str=str.replace(/\\s/g,',');str=str.split(/[,，；;.。]/g);var string='';str.forEach(function(item){if(item!==''){string+=item;}});return string;}commodityName=reg(commodityName);category=reg(category);if(cid!==''){cid*=1;}var searchCondition={cid:cid,commodityName:commodityName,category:category,status:status};console.log(searchCondition);reqwest({url:'/searchcommodity',method:'post',type:'json',data:searchCondition}).then(function(res){console.log(res);if(res.status==='success'){_this.setState({data:res.commodities,total:res.total});message.success(\"搜索成功！\");}else{message.error(\"查无该商品！\");}});};_this.statusSelectChange=function(e){console.log(e);_this.statusSelect.value=e;};_this.categorySelectChange=function(e){console.log(e);_this.categorySelect.value=e;};_this.showCategoryList=function(){return _this.state.subCategory.map(function(item,index){// console.log(item.category)\nreturn/*#__PURE__*/_jsx(Option,{value:\"\".concat(item.category),children:item.category},nanoid());});};_this.showCommodityInit=function(){var Demo=function Demo(){return/*#__PURE__*/_jsx(\"div\",{className:\"background\",children:/*#__PURE__*/_jsx(Affix,{target:function target(){return _this.commodityListElev;},children:/*#__PURE__*/_jsxs(\"div\",{className:\"search\",children:[/*#__PURE__*/_jsx(Divider,{style:{margin:0}}),/*#__PURE__*/_jsxs(Space,{style:{marginTop:20},size:20,children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u5546\\u54C1\\u7F16\\u53F7:\",/*#__PURE__*/_jsx(InputNumber,{name:\"cid\",className:\"CimInput\",min:0,ref:function ref(elev){_this.idInput=elev;}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u5546\\u54C1\\u540D\\u79F0:\",/*#__PURE__*/_jsx(Input,{name:\"commodity\",className:\"CimInput\",ref:function ref(elev){_this.nameInput=elev;}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u5546\\u54C1\\u5206\\u7C7B:\",/*#__PURE__*/_jsx(Select,{name:\"category\",style:{width:100},ref:function ref(elev){_this.categorySelect=elev;},onChange:_this.categorySelectChange,children:_this.showCategoryList()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u5546\\u54C1\\u72B6\\u6001:\",/*#__PURE__*/_jsxs(Select,{name:\"status\",style:{width:100},defaultValue:\"\\u5728\\u552E\",ref:function ref(elev){_this.statusSelect=elev;},onChange:_this.statusSelectChange,children:[/*#__PURE__*/_jsx(Option,{value:\"\\u5728\\u552E\",children:\"\\u5728\\u552E\"}),/*#__PURE__*/_jsx(Option,{value:\"\\u5DF2\\u4E0B\\u67B6\",children:\"\\u5DF2\\u4E0B\\u67B6\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:20},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",shape:\"circle\",icon:/*#__PURE__*/_jsx(SearchOutlined,{}),onClick:_this.CimSearch})}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:20},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",style:{borderRadius:5},children:/*#__PURE__*/_jsx(Link,{to:\"/home/cim/addcommodity\",children:\"\\u6DFB\\u52A0\\u5546\\u54C1\"})})})]})]})})});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Demo,{}),/*#__PURE__*/_jsx(\"div\",{className:\"contentWraper\",children:/*#__PURE__*/_jsx(\"div\",{style:{padding:0},children:undefined===_this.state.data[0]?/*#__PURE__*/_jsx(Empty,{style:{paddingTop:150}}):/*#__PURE__*/_jsx(Row,{gutter:10,className:\"\",children:_this.showCommodity()})})})]});};_this.componentDidMount=function(){console.log(\"页面初始渲染\");_this.fetchData(function(res){console.log(res);_this.setState({data:res.commodities,total:res.total});});// 请求分类列表\nreqwest({url:'/category/allcategory',method:'get',type:'json'}).then(function(res){// console.log(res.results)\n_this.setState({subCategory:res});});};return _this;}_createClass(Cim,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsx(\"div\",{className:\"content-scroll\",ref:function ref(elev){_this2.commodityListElev=elev;},children:/*#__PURE__*/_jsxs(InfiniteScroll,{initialLoad:false,pageStart:0,loadMore:this.handleInfiniteOnLoad,hasMore:!this.state.loading&&this.state.hasMore,useWindow:false,children:[/*#__PURE__*/_jsx(Divider,{style:{margin:0}}),/*#__PURE__*/_jsxs(\"div\",{className:\"descwraper\",children:[/*#__PURE__*/_jsxs(Breadcrumb,{className:\"bdc\",children:[/*#__PURE__*/_jsx(Breadcrumb.Item,{children:/*#__PURE__*/_jsx(\"a\",{href:\"/home\",children:\"\\u4E3B\\u9875\"})}),/*#__PURE__*/_jsx(Breadcrumb.Item,{children:\"\\u5546\\u54C1\\u4FE1\\u606F\\u7BA1\\u7406\"})]}),/*#__PURE__*/_jsx(Descriptions,{title:\"\\u5546\\u54C1\\u7BA1\\u7406\",className:\"desc\",children:/*#__PURE__*/_jsx(Descriptions.Item,{children:\"\\u4ED3\\u5E93\\u5546\\u54C1\\u4FE1\\u606F\\u5C55\\u793A\\uFF0C\\u53EF\\u4EE5\\u8FDB\\u884C\\u65B0\\u589E\\u5546\\u54C1\\uFF0C\\u641C\\u7D22\\u5546\\u54C1\\uFF0C\\u7F16\\u8F91\\u5546\\u54C1\\uFF0C\\u5220\\u9664\\u5546\\u54C1\\u64CD\\u4F5C\"})})]}),/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/home/cim/addcommodity\",component:CimAddCommodity}),/*#__PURE__*/_jsx(Route,{path:\"/home/cim\",component:this.showCommodityInit})]})})]})});}}]);return Cim;}(Component);export{Cim as default};","map":{"version":3,"sources":["D:/code/cloud-supermarket-management-system/src/components/Content/Cim/Cim.jsx"],"names":["React","Component","Descriptions","Divider","Breadcrumb","Button","Input","message","InputNumber","Empty","Select","Col","Row","Space","Affix","BrowserRouter","Link","Switch","Route","SearchOutlined","InfiniteScroll","nanoid","reqwest","CommodityCard","CimAddCommodity","Option","Cim","state","data","subCategory","loading","hasMore","total","isAddCategory","count","pageSize","fetchData","callback","setState","url","type","method","success","res","handleInfiniteOnLoad","length","warning","concat","commodities","renderCommodityList","cid","end","then","console","log","error","showCommodity","map","item","index","marginBottom","CimSearch","idInput","value","nameInput","categorySelect","undefined","statusSelect","props","defaultValue","commodityName","category","status","reg","str","replace","split","string","forEach","searchCondition","statusSelectChange","e","categorySelectChange","showCategoryList","showCommodityInit","Demo","commodityListElev","margin","marginTop","elev","width","marginLeft","borderRadius","padding","paddingTop","componentDidMount"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { Descriptions, Divider, Breadcrumb, Button, Input, message, InputNumber, Empty, Select, Col, Row, Space, Affix } from 'antd';\r\nimport { BrowserRouter, Link, Switch, Route } from 'react-router-dom'\r\nimport { SearchOutlined } from '@ant-design/icons'\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport { nanoid } from 'nanoid'\r\nimport './index.css'\r\nimport reqwest from 'reqwest';\r\nimport CommodityCard from '../../../utils/CimCommodityCard/CommodityCard'\r\nimport CimAddCommodity from '../../../utils/CimAddCommodity/CimAddCommodity'\r\n\r\nconst { Option } = Select;\r\n\r\nexport default class Cim extends Component {\r\n\r\n    state = {\r\n        data: [],\r\n        subCategory: [],\r\n        loading: false,\r\n        hasMore: true,\r\n        total: '',\r\n        isAddCategory: false,\r\n        count: 0,\r\n        pageSize: 8\r\n    };\r\n\r\n    fetchData = callback => {\r\n        let count = this.state.count\r\n        let pageSize = this.state.pageSize\r\n        count += 1\r\n        this.setState({\r\n            count: count\r\n        })\r\n        let data = { count, pageSize }\r\n        reqwest({\r\n            url: '/commoditylist',\r\n            type: 'json',\r\n            method: 'post',\r\n            data: data,\r\n            success: res => {\r\n                callback(res);\r\n            },\r\n        });\r\n    };\r\n\r\n    handleInfiniteOnLoad = () => {\r\n        let { data, total } = this.state;\r\n        this.setState({\r\n            loading: true,\r\n        });\r\n        if (data.length >= total) {\r\n            message.warning('商品已展示完毕');\r\n            this.setState({\r\n                hasMore: false,\r\n                loading: false,\r\n            });\r\n            return;\r\n        }\r\n        this.fetchData(res => {\r\n            data = data.concat(res.commodities);\r\n            this.setState({\r\n                data,\r\n                loading: false,\r\n                total: res.total\r\n            });\r\n        });\r\n    };\r\n\r\n    // 删除操作，请求数据库重新渲染数据到页面\r\n    renderCommodityList = (cid) => {\r\n        let count = this.state.count\r\n        let pageSize = this.state.pageSize\r\n        let end = count * pageSize\r\n        reqwest({\r\n            url: '/deletecommodity',\r\n            method: 'post',\r\n            type: 'json',\r\n            data: { cid, end }\r\n        })\r\n            .then(res => {\r\n                console.log(res)\r\n                this.setState({\r\n                    data: res.commodities\r\n                })\r\n                message.success('删除成功');\r\n            }, () => {\r\n                message.error('删除失败');\r\n            })\r\n    }\r\n    // 展示商品列表\r\n    showCommodity = () => {\r\n        console.log(this.state.data)\r\n        return this.state.data.map((item, index) => {\r\n            return (\r\n                // 循环项的key值，不要用index，可以用nanoid来设置\r\n                <Col span={6} style={{ marginBottom: 20 }} key={nanoid()} >\r\n                    <CommodityCard data={item} renderCommodityList={this.renderCommodityList} />\r\n                </Col>\r\n            )\r\n        })\r\n    }\r\n    // 搜索商品\r\n    CimSearch = () => {\r\n        let [cid, commodityName = ' ', category = ' ', status] = [\r\n            this.idInput.value,\r\n            this.nameInput.state.value,\r\n            this.categorySelect.value,\r\n            (undefined === this.statusSelect.value) ? this.statusSelect.props.defaultValue : this.statusSelect.value\r\n        ]\r\n        // 去除搜索内容中的空格，常见标点符号\r\n        function reg(str) {\r\n            str = str.replace(/\\s/g, ',')\r\n            str = str.split(/[,，；;.。]/g)\r\n            let string = ''\r\n            str.forEach(item => {\r\n                if (item !== '') {\r\n                    string += (item)\r\n                }\r\n            })\r\n            return string\r\n        }\r\n        commodityName = reg(commodityName)\r\n        category = reg(category)\r\n        if (cid !== '') {\r\n            cid *= 1\r\n        }\r\n        const searchCondition = { cid, commodityName, category, status }\r\n        console.log(searchCondition)\r\n        reqwest({\r\n            url: '/searchcommodity',\r\n            method: 'post',\r\n            type: 'json',\r\n            data: searchCondition\r\n        })\r\n            .then(res => {\r\n                console.log(res)\r\n                if (res.status === 'success') {\r\n                    this.setState({\r\n                        data: res.commodities,\r\n                        total:res.total\r\n                    })\r\n                    message.success(\"搜索成功！\")\r\n                } else {\r\n                    message.error(\"查无该商品！\")\r\n                }\r\n\r\n            })\r\n    }\r\n    // 获取下拉框的值\r\n    statusSelectChange = (e) => {\r\n        console.log(e)\r\n        this.statusSelect.value = e\r\n    }\r\n    categorySelectChange = (e) => {\r\n        console.log(e)\r\n        this.categorySelect.value = e\r\n    }\r\n    // 渲染分类下拉框的选项\r\n    showCategoryList = () => {\r\n        return this.state.subCategory.map((item, index) => {\r\n            // console.log(item.category)\r\n            return <Option value={`${item.category}`} key={nanoid()}>{item.category}</Option>\r\n        })\r\n    }\r\n    // 渲染初始商品操作页面\r\n    showCommodityInit = () => {\r\n        const Demo = () => {\r\n            return (\r\n                <div className=\"background\">\r\n                    <Affix target={() => this.commodityListElev}>\r\n                        <div className=\"search\">\r\n                            <Divider style={{ margin: 0 }} />\r\n                            <Space style={{ marginTop: 20 }} size={20}>\r\n                                <div>\r\n                                    商品编号:\r\n                                    <InputNumber name='cid' className=\"CimInput\" min={0} ref={elev => { this.idInput = elev }} />\r\n                                </div>\r\n                                <div>\r\n                                    商品名称:\r\n                                    <Input name=\"commodity\" className=\"CimInput\" ref={elev => { this.nameInput = elev }} />\r\n                                </div>\r\n                                <div>\r\n                                    商品分类:\r\n                                    <Select\r\n                                        name='category'\r\n                                        style={{ width: 100 }}\r\n                                        ref={elev => { this.categorySelect = elev }}\r\n                                        onChange={this.categorySelectChange}\r\n                                    >\r\n                                        {this.showCategoryList()}\r\n                                    </Select >\r\n                                </div>\r\n                                <div>\r\n                                    商品状态:\r\n                                    <Select\r\n                                        name='status'\r\n                                        style={{ width: 100 }}\r\n                                        defaultValue='在售'\r\n                                        ref={elev => { this.statusSelect = elev }}\r\n                                        onChange={this.statusSelectChange}\r\n                                    >\r\n                                        <Option value=\"在售\">在售</Option>\r\n                                        <Option value=\"已下架\">已下架</Option>\r\n                                    </Select >\r\n                                </div>\r\n                                <div style={{ marginLeft: 20 }}>\r\n                                    <Button type=\"primary\" shape=\"circle\" icon={<SearchOutlined />} onClick={this.CimSearch} />\r\n                                </div>\r\n                                <div style={{ marginLeft: 20 }}>\r\n                                    <Button type=\"primary\" style={{ borderRadius: 5 }}>\r\n                                        <Link to=\"/home/cim/addcommodity\">\r\n                                            添加商品\r\n                                        </Link>\r\n                                    </Button>\r\n                                </div>\r\n                            </Space>\r\n                        </div>\r\n                    </Affix>\r\n                </div>\r\n            );\r\n        };\r\n        return <>\r\n            <Demo />\r\n            <div className=\"contentWraper\">\r\n                <div style={{ padding: 0 }}>\r\n                    {/* {console.log(this.state.data)} */}\r\n                    {(undefined === this.state.data[0]) ? <Empty style={{ paddingTop: 150 }} /> :\r\n                        <Row gutter={10} className=\"\">\r\n                            {\r\n                                this.showCommodity()\r\n                            }\r\n                        </Row>\r\n                    }\r\n                </div>\r\n            </div>\r\n        </>\r\n    }\r\n\r\n    componentDidMount = () => {\r\n        console.log(\"页面初始渲染\")\r\n        this.fetchData(res => {\r\n            console.log(res)\r\n            this.setState({\r\n                data: res.commodities,\r\n                total: res.total\r\n            });\r\n        });\r\n        // 请求分类列表\r\n        reqwest({\r\n            url: '/category/allcategory',\r\n            method: 'get',\r\n            type: 'json'\r\n        })\r\n            .then(res => {\r\n                // console.log(res.results)\r\n                this.setState({\r\n                    subCategory: res\r\n                })\r\n            })\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"content-scroll\" ref={elev => { this.commodityListElev = elev }}>\r\n                <InfiniteScroll\r\n                    initialLoad={false}\r\n                    pageStart={0}\r\n                    loadMore={this.handleInfiniteOnLoad}\r\n                    hasMore={!this.state.loading && this.state.hasMore}\r\n                    useWindow={false}\r\n                >\r\n                    <Divider style={{ margin: 0 }} />\r\n                    <div className=\"descwraper\">\r\n                        <Breadcrumb className=\"bdc\">\r\n                            <Breadcrumb.Item>\r\n                                <a href=\"/home\">主页</a>\r\n                            </Breadcrumb.Item>\r\n                            <Breadcrumb.Item>商品信息管理</Breadcrumb.Item>\r\n                        </Breadcrumb>\r\n                        <Descriptions title=\"商品管理\" className=\"desc\">\r\n                            <Descriptions.Item>仓库商品信息展示，可以进行新增商品，搜索商品，编辑商品，删除商品操作</Descriptions.Item>\r\n                        </Descriptions>\r\n                    </div>\r\n                    <BrowserRouter>\r\n                        <Switch>\r\n                            <Route path=\"/home/cim/addcommodity\" component={CimAddCommodity} />\r\n                            <Route path=\"/home/cim\" component={this.showCommodityInit} />\r\n                        </Switch>\r\n                    </BrowserRouter>\r\n                </InfiniteScroll>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}