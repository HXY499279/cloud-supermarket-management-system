{"ast":null,"code":"import { mod, toRadian, isSamePoint } from './util'; // 向量长度\n\nfunction vMag(v) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n} // u.v/|u||v|，计算夹角的余弦值\n\n\nfunction vRatio(u, v) {\n  // 当存在一个向量的长度为 0 时，夹角也为 0，即夹角的余弦值为 1\n  return vMag(u) * vMag(v) ? (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v)) : 1;\n} // 向量角度\n\n\nfunction vAngle(u, v) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n} // A 0:rx 1:ry 2:x-axis-rotation 3:large-arc-flag 4:sweep-flag 5: x 6: y\n\n\nexport default function getArcParams(startPoint, params) {\n  var rx = params[1];\n  var ry = params[2];\n  var xRotation = mod(toRadian(params[3]), Math.PI * 2);\n  var arcFlag = params[4];\n  var sweepFlag = params[5]; // 弧形起点坐标\n\n  var x1 = startPoint[0];\n  var y1 = startPoint[1]; // 弧形终点坐标\n\n  var x2 = params[6];\n  var y2 = params[7];\n  var xp = Math.cos(xRotation) * (x1 - x2) / 2.0 + Math.sin(xRotation) * (y1 - y2) / 2.0;\n  var yp = -1 * Math.sin(xRotation) * (x1 - x2) / 2.0 + Math.cos(xRotation) * (y1 - y2) / 2.0;\n  var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n  var diff = rx * rx * (yp * yp) + ry * ry * (xp * xp);\n  var f = diff ? Math.sqrt((rx * rx * (ry * ry) - diff) / diff) : 1;\n\n  if (arcFlag === sweepFlag) {\n    f *= -1;\n  }\n\n  if (isNaN(f)) {\n    f = 0;\n  } // 旋转前的起点坐标，且当长半轴和短半轴的长度为 0 时，坐标按 (0, 0) 处理\n\n\n  var cxp = ry ? f * rx * yp / ry : 0;\n  var cyp = rx ? f * -ry * xp / rx : 0; // 椭圆圆心坐标\n\n  var cx = (x1 + x2) / 2.0 + Math.cos(xRotation) * cxp - Math.sin(xRotation) * cyp;\n  var cy = (y1 + y2) / 2.0 + Math.sin(xRotation) * cxp + Math.cos(xRotation) * cyp; // 起始点的单位向量\n\n  var u = [(xp - cxp) / rx, (yp - cyp) / ry]; // 终止点的单位向量\n\n  var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry]; // 计算起始点和圆心的连线，与 x 轴正方向的夹角\n\n  var theta = vAngle([1, 0], u); // 计算圆弧起始点和终止点与椭圆圆心连线的夹角\n\n  var dTheta = vAngle(u, v);\n\n  if (vRatio(u, v) <= -1) {\n    dTheta = Math.PI;\n  }\n\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n\n  if (sweepFlag === 0 && dTheta > 0) {\n    dTheta = dTheta - 2 * Math.PI;\n  }\n\n  if (sweepFlag === 1 && dTheta < 0) {\n    dTheta = dTheta + 2 * Math.PI;\n  }\n\n  return {\n    cx: cx,\n    cy: cy,\n    // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n    rx: isSamePoint(startPoint, [x2, y2]) ? 0 : rx,\n    ry: isSamePoint(startPoint, [x2, y2]) ? 0 : ry,\n    startAngle: theta,\n    endAngle: theta + dTheta,\n    xRotation: xRotation,\n    arcFlag: arcFlag,\n    sweepFlag: sweepFlag\n  };\n}","map":{"version":3,"sources":["../../src/util/arc-params.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { mod, toRadian, isSamePoint } from './util';\n// 向量长度\nfunction vMag(v) {\n    return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n}\n// u.v/|u||v|，计算夹角的余弦值\nfunction vRatio(u, v) {\n    // 当存在一个向量的长度为 0 时，夹角也为 0，即夹角的余弦值为 1\n    return vMag(u) * vMag(v) ? (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v)) : 1;\n}\n// 向量角度\nfunction vAngle(u, v) {\n    return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n}\n// A 0:rx 1:ry 2:x-axis-rotation 3:large-arc-flag 4:sweep-flag 5: x 6: y\nexport default function getArcParams(startPoint, params) {\n    var rx = params[1];\n    var ry = params[2];\n    var xRotation = mod(toRadian(params[3]), Math.PI * 2);\n    var arcFlag = params[4];\n    var sweepFlag = params[5];\n    // 弧形起点坐标\n    var x1 = startPoint[0];\n    var y1 = startPoint[1];\n    // 弧形终点坐标\n    var x2 = params[6];\n    var y2 = params[7];\n    var xp = (Math.cos(xRotation) * (x1 - x2)) / 2.0 + (Math.sin(xRotation) * (y1 - y2)) / 2.0;\n    var yp = (-1 * Math.sin(xRotation) * (x1 - x2)) / 2.0 + (Math.cos(xRotation) * (y1 - y2)) / 2.0;\n    var lambda = (xp * xp) / (rx * rx) + (yp * yp) / (ry * ry);\n    if (lambda > 1) {\n        rx *= Math.sqrt(lambda);\n        ry *= Math.sqrt(lambda);\n    }\n    var diff = rx * rx * (yp * yp) + ry * ry * (xp * xp);\n    var f = diff ? Math.sqrt((rx * rx * (ry * ry) - diff) / diff) : 1;\n    if (arcFlag === sweepFlag) {\n        f *= -1;\n    }\n    if (isNaN(f)) {\n        f = 0;\n    }\n    // 旋转前的起点坐标，且当长半轴和短半轴的长度为 0 时，坐标按 (0, 0) 处理\n    var cxp = ry ? (f * rx * yp) / ry : 0;\n    var cyp = rx ? (f * -ry * xp) / rx : 0;\n    // 椭圆圆心坐标\n    var cx = (x1 + x2) / 2.0 + Math.cos(xRotation) * cxp - Math.sin(xRotation) * cyp;\n    var cy = (y1 + y2) / 2.0 + Math.sin(xRotation) * cxp + Math.cos(xRotation) * cyp;\n    // 起始点的单位向量\n    var u = [(xp - cxp) / rx, (yp - cyp) / ry];\n    // 终止点的单位向量\n    var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n    // 计算起始点和圆心的连线，与 x 轴正方向的夹角\n    var theta = vAngle([1, 0], u);\n    // 计算圆弧起始点和终止点与椭圆圆心连线的夹角\n    var dTheta = vAngle(u, v);\n    if (vRatio(u, v) <= -1) {\n        dTheta = Math.PI;\n    }\n    if (vRatio(u, v) >= 1) {\n        dTheta = 0;\n    }\n    if (sweepFlag === 0 && dTheta > 0) {\n        dTheta = dTheta - 2 * Math.PI;\n    }\n    if (sweepFlag === 1 && dTheta < 0) {\n        dTheta = dTheta + 2 * Math.PI;\n    }\n    return {\n        cx: cx,\n        cy: cy,\n        // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n        rx: isSamePoint(startPoint, [x2, y2]) ? 0 : rx,\n        ry: isSamePoint(startPoint, [x2, y2]) ? 0 : ry,\n        startAngle: theta,\n        endAngle: theta + dTheta,\n        xRotation: xRotation,\n        arcFlag: arcFlag,\n        sweepFlag: sweepFlag,\n    };\n}\n//# sourceMappingURL=arc-params.js.map"]},"metadata":{},"sourceType":"module"}