{"ast":null,"code":"import { isAllowCapture, multiplyVec2, invert } from '@antv/g-base';\n\nfunction invertFromMatrix(v, matrix) {\n  if (matrix) {\n    var invertMatrix = invert(matrix);\n    return multiplyVec2(invertMatrix, v);\n  }\n\n  return v;\n}\n\nfunction getRefXY(element, x, y) {\n  // @ts-ignore\n  var totalMatrix = element.getTotalMatrix();\n\n  if (totalMatrix) {\n    var _a = invertFromMatrix([x, y, 1], totalMatrix),\n        refX = _a[0],\n        refY = _a[1];\n\n    return [refX, refY];\n  }\n\n  return [x, y];\n} // 拾取前的检测，只有通过检测才能继续拾取\n\n\nfunction preTest(element, x, y) {\n  // @ts-ignore\n  if (element.isCanvas && element.isCanvas()) {\n    return true;\n  } // 不允许被拾取，则返回 null\n  // @ts-ignore\n\n\n  if (!isAllowCapture(element) || element.cfg.isInView === false) {\n    return false;\n  }\n\n  if (element.cfg.clipShape) {\n    // 如果存在 clip\n    var _a = getRefXY(element, x, y),\n        refX = _a[0],\n        refY = _a[1];\n\n    if (element.isClipped(refX, refY)) {\n      return false;\n    }\n  } // @ts-ignore ，这个地方调用过于频繁\n\n\n  var bbox = element.cfg.cacheCanvasBBox || element.getCanvasBBox(); // 如果没有缓存 bbox，则说明不可见\n  // 注释掉的这段可能会加速拾取，上面的语句改写成 const bbox = element.cfg.cacheCanvasBBox;\n  // 这时候的拾取假设图形/分组在上一次绘制都在视窗内，但是上面已经判定了 isInView 所以意义不大\n  // 现在还调用 element.getCanvasBBox(); 一个很大的原因是便于单元测试\n  // if (!bbox) {\n  //   return false;\n  // }\n\n  if (!(x >= bbox.minX && x <= bbox.maxX && y >= bbox.minY && y <= bbox.maxY)) {\n    return false;\n  }\n\n  return true;\n} // 这个方法复写了 g-base 的 getShape\n\n\nexport function getShape(container, x, y) {\n  // 没有通过检测，则返回 null\n  if (!preTest(container, x, y)) {\n    return null;\n  }\n\n  var shape = null;\n  var children = container.getChildren();\n  var count = children.length;\n\n  for (var i = count - 1; i >= 0; i--) {\n    var child = children[i];\n\n    if (child.isGroup()) {\n      shape = getShape(child, x, y);\n    } else if (preTest(child, x, y)) {\n      var curShape = child;\n\n      var _a = getRefXY(child, x, y),\n          refX = _a[0],\n          refY = _a[1]; // @ts-ignore\n\n\n      if (curShape.isInShape(refX, refY)) {\n        shape = child;\n      }\n    }\n\n    if (shape) {\n      break;\n    }\n  }\n\n  return shape;\n}","map":{"version":3,"sources":["../../src/util/hit.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { isAllowCapture, multiplyVec2, invert } from '@antv/g-base';\nfunction invertFromMatrix(v, matrix) {\n    if (matrix) {\n        var invertMatrix = invert(matrix);\n        return multiplyVec2(invertMatrix, v);\n    }\n    return v;\n}\nfunction getRefXY(element, x, y) {\n    // @ts-ignore\n    var totalMatrix = element.getTotalMatrix();\n    if (totalMatrix) {\n        var _a = invertFromMatrix([x, y, 1], totalMatrix), refX = _a[0], refY = _a[1];\n        return [refX, refY];\n    }\n    return [x, y];\n}\n// 拾取前的检测，只有通过检测才能继续拾取\nfunction preTest(element, x, y) {\n    // @ts-ignore\n    if (element.isCanvas && element.isCanvas()) {\n        return true;\n    }\n    // 不允许被拾取，则返回 null\n    // @ts-ignore\n    if (!isAllowCapture(element) || element.cfg.isInView === false) {\n        return false;\n    }\n    if (element.cfg.clipShape) {\n        // 如果存在 clip\n        var _a = getRefXY(element, x, y), refX = _a[0], refY = _a[1];\n        if (element.isClipped(refX, refY)) {\n            return false;\n        }\n    }\n    // @ts-ignore ，这个地方调用过于频繁\n    var bbox = element.cfg.cacheCanvasBBox || element.getCanvasBBox();\n    // 如果没有缓存 bbox，则说明不可见\n    // 注释掉的这段可能会加速拾取，上面的语句改写成 const bbox = element.cfg.cacheCanvasBBox;\n    // 这时候的拾取假设图形/分组在上一次绘制都在视窗内，但是上面已经判定了 isInView 所以意义不大\n    // 现在还调用 element.getCanvasBBox(); 一个很大的原因是便于单元测试\n    // if (!bbox) {\n    //   return false;\n    // }\n    if (!(x >= bbox.minX && x <= bbox.maxX && y >= bbox.minY && y <= bbox.maxY)) {\n        return false;\n    }\n    return true;\n}\n// 这个方法复写了 g-base 的 getShape\nexport function getShape(container, x, y) {\n    // 没有通过检测，则返回 null\n    if (!preTest(container, x, y)) {\n        return null;\n    }\n    var shape = null;\n    var children = container.getChildren();\n    var count = children.length;\n    for (var i = count - 1; i >= 0; i--) {\n        var child = children[i];\n        if (child.isGroup()) {\n            shape = getShape(child, x, y);\n        }\n        else if (preTest(child, x, y)) {\n            var curShape = child;\n            var _a = getRefXY(child, x, y), refX = _a[0], refY = _a[1];\n            // @ts-ignore\n            if (curShape.isInShape(refX, refY)) {\n                shape = child;\n            }\n        }\n        if (shape) {\n            break;\n        }\n    }\n    return shape;\n}\n//# sourceMappingURL=hit.js.map"]},"metadata":{},"sourceType":"module"}