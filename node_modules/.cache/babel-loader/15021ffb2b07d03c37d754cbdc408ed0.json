{"ast":null,"code":"/**\n * @fileoverview image\n * @author dengfuping_develop@163.com\n */\nimport { __assign, __extends } from \"tslib\";\nimport { each, isString } from '@antv/util';\nimport { SVG_ATTR_MAP } from '../constant';\nimport ShapeBase from './base';\n\nvar Image =\n/** @class */\nfunction (_super) {\n  __extends(Image, _super);\n\n  function Image() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'image';\n    _this.canFill = false;\n    _this.canStroke = false;\n    return _this;\n  }\n\n  Image.prototype.getDefaultAttrs = function () {\n    var attrs = _super.prototype.getDefaultAttrs.call(this);\n\n    return __assign(__assign({}, attrs), {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n  };\n\n  Image.prototype.createPath = function (context, targetAttrs) {\n    var _this = this;\n\n    var attrs = this.attr();\n    var el = this.get('el');\n    each(targetAttrs || attrs, function (value, attr) {\n      if (attr === 'img') {\n        _this._setImage(attrs.img);\n      } else if (SVG_ATTR_MAP[attr]) {\n        el.setAttribute(SVG_ATTR_MAP[attr], value);\n      }\n    });\n  };\n\n  Image.prototype.setAttr = function (name, value) {\n    this.attrs[name] = value;\n\n    if (name === 'img') {\n      this._setImage(value);\n    }\n  };\n\n  Image.prototype._setImage = function (img) {\n    var attrs = this.attr();\n    var el = this.get('el');\n\n    if (isString(img)) {\n      el.setAttribute('href', img);\n    } else if (img instanceof window.Image) {\n      if (!attrs.width) {\n        el.setAttribute('width', img.width);\n        this.attr('width', img.width);\n      }\n\n      if (!attrs.height) {\n        el.setAttribute('height', img.height);\n        this.attr('height', img.height);\n      }\n\n      el.setAttribute('href', img.src);\n    } else if (img instanceof HTMLElement && isString(img.nodeName) && img.nodeName.toUpperCase() === 'CANVAS') {\n      // @ts-ignore\n      el.setAttribute('href', img.toDataURL());\n    } else if (img instanceof ImageData) {\n      var canvas = document.createElement('canvas');\n      canvas.setAttribute('width', \"\" + img.width);\n      canvas.setAttribute('height', \"\" + img.height);\n      canvas.getContext('2d').putImageData(img, 0, 0);\n\n      if (!attrs.width) {\n        el.setAttribute('width', \"\" + img.width);\n        this.attr('width', img.width);\n      }\n\n      if (!attrs.height) {\n        el.setAttribute('height', \"\" + img.height);\n        this.attr('height', img.height);\n      }\n\n      el.setAttribute('href', canvas.toDataURL());\n    }\n  };\n\n  return Image;\n}(ShapeBase);\n\nexport default Image;","map":{"version":3,"sources":["../../src/shape/image.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\n * @fileoverview image\n * @author dengfuping_develop@163.com\n */\nimport { __assign, __extends } from \"tslib\";\nimport { each, isString } from '@antv/util';\nimport { SVG_ATTR_MAP } from '../constant';\nimport ShapeBase from './base';\nvar Image = /** @class */ (function (_super) {\n    __extends(Image, _super);\n    function Image() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.type = 'image';\n        _this.canFill = false;\n        _this.canStroke = false;\n        return _this;\n    }\n    Image.prototype.getDefaultAttrs = function () {\n        var attrs = _super.prototype.getDefaultAttrs.call(this);\n        return __assign(__assign({}, attrs), { x: 0, y: 0, width: 0, height: 0 });\n    };\n    Image.prototype.createPath = function (context, targetAttrs) {\n        var _this = this;\n        var attrs = this.attr();\n        var el = this.get('el');\n        each(targetAttrs || attrs, function (value, attr) {\n            if (attr === 'img') {\n                _this._setImage(attrs.img);\n            }\n            else if (SVG_ATTR_MAP[attr]) {\n                el.setAttribute(SVG_ATTR_MAP[attr], value);\n            }\n        });\n    };\n    Image.prototype.setAttr = function (name, value) {\n        this.attrs[name] = value;\n        if (name === 'img') {\n            this._setImage(value);\n        }\n    };\n    Image.prototype._setImage = function (img) {\n        var attrs = this.attr();\n        var el = this.get('el');\n        if (isString(img)) {\n            el.setAttribute('href', img);\n        }\n        else if (img instanceof window.Image) {\n            if (!attrs.width) {\n                el.setAttribute('width', img.width);\n                this.attr('width', img.width);\n            }\n            if (!attrs.height) {\n                el.setAttribute('height', img.height);\n                this.attr('height', img.height);\n            }\n            el.setAttribute('href', img.src);\n        }\n        else if (img instanceof HTMLElement && isString(img.nodeName) && img.nodeName.toUpperCase() === 'CANVAS') {\n            // @ts-ignore\n            el.setAttribute('href', img.toDataURL());\n        }\n        else if (img instanceof ImageData) {\n            var canvas = document.createElement('canvas');\n            canvas.setAttribute('width', \"\" + img.width);\n            canvas.setAttribute('height', \"\" + img.height);\n            canvas.getContext('2d').putImageData(img, 0, 0);\n            if (!attrs.width) {\n                el.setAttribute('width', \"\" + img.width);\n                this.attr('width', img.width);\n            }\n            if (!attrs.height) {\n                el.setAttribute('height', \"\" + img.height);\n                this.attr('height', img.height);\n            }\n            el.setAttribute('href', canvas.toDataURL());\n        }\n    };\n    return Image;\n}(ShapeBase));\nexport default Image;\n//# sourceMappingURL=image.js.map"]},"metadata":{},"sourceType":"module"}